const testInput:string = "....#.....\n.........#\n..........\n..#.......\n.......#..\n..........\n.#..^.....\n........#.\n#.........\n......#...";
const input:string = "...#....#................................#..........................#..........#.............#..#.................................\n.......#........................#.......#......................#............#.....................................................\n..#......#....................................................................................#.......#................#..........\n..................#...........#...#..#............................#.........#...................#...............................#.\n..#...................................................................................................................#....#......\n............#.............................#......................#.......#...........#..................##..............#.........\n..............................#................................................#.............................................#....\n....................#.#...........#...#....#..............#.........#.........#..................#...........#.................#..\n.#........................................................................#.....#.......##.....................#..................\n.#........................#..................................#............................#...#..........#.......#.............#..\n................................#......#...............#...........................#.............................#..#.#...#....#..\n..........................................................#..........#..#.......#........#............#.................#.........\n......#.......#......................................................................................#................#...........\n##......#...................................................#................#............................#.......................\n.....#.................................................................#.....................#...............................#...#\n...........................................................................................................#......................\n........#......................#..........#..#....#....................#..##...........#..#.............................#.#......#\n#...#..................#.....................#...#...#.......................................................#.....#..............\n#...#..................#.#....#...............#...........#...................#.....##......................................#.....\n......#............................................................................................#...#.#........................\n......................................................#..............#.....#.....#..#...........#..............................#..\n.........................##.#..............#............#....................................................................##...\n..#....................#...........................................................................................#......#.##....\n..............#........#..#.......#................#.....#.......................................................................#\n.........#..........................#........#..........#...............#...................................#.............#.......\n...........#.....................#.....#..............#......#.........................................#..........................\n.......##.............................#.........#...............#...............#..............................................#..\n.......#.....#.....#...........#............................................................................#..............#.....#\n....#.............................................#....#....#....#...........................................##..............##...\n.#.............#.......#.....#.........#....#......#.............#............#......#............#......................#........\n..................................................................................................#....#..........................\n.............................................#....................#...............................#.............#.................\n.........#...............#.....................#...............#......#.................................................#.........\n..........#.................................................................................#..............#..............#.....#.\n.........................#........#.....#............#.....................#.......................................#..............\n.....................#.....................#..............................#..................................#..........#.........\n........................#.....................#..............................#.#................#.................................\n.....................................................#...............#.......................................................#....\n.................#.......#......##..............................##.................#..........................#....#....#........#\n.............................#................................#..#...........#..........#.........................................\n.#...........................#........#.#...#...#....#......#......#...........#..................##.........................#....\n.......................................#......................................#................................................#..\n..........##......#..............................................................#.......#....................#..#......#.........\n.#...............#............#....#....................................^......#.........................................#.#......\n.................#....................#..#....#.......................#.............................#.....#.....#............#....\n...............................................................#...............##.................#........#.#....................\n...................................#..#.........#.........#...............#.........#.......................................#.....\n.........................#......................................................................................#............#....\n.................................#............#............#.............................#........................................\n..........#.........#...........................................#..#...#..#.......................................................\n.#....#....#..........................................#.....#..........................................................#..........\n...#...............#......................................................................#.............................#.........\n....#......................#...........#......................................#..............#...........................#........\n.......................................................#...........#.......#..............................#.......................\n......#............#.#...........#............#...................#..................#................................##..........\n.......#..........................................................................................#.....................##........\n....................................#.........#..................##....................#.#...........#......................#.....\n.........................#...............................................................#....................#...................\n...............................#........................................................................#....................#....\n..#.#.......................................................................#..........#.........#........#.......................\n....#....#.....................#.............#..#........................#.............#.....#....................................\n..#............................................................................#....................#.................#.....#.#...\n..............................................#........#............##.#..............#...#...................#...................\n.............................#..................#..................#.................................#............................\n......#................................#....#..................................#............#.....................................\n#..........#...#..................#...............................................................................................\n......................................#......................................#.......#....#.......................................\n......................................................................#......................................#...........##.....#.\n.......#.............#................................................#.....#..#......#......................................#....\n..........................................#...............#...#........#..........................................................\n#..#......#..........#....#.......................................................................................................\n.......#..#............................................................#........#...#.#...........................................\n.#....#...#..#................................................#......................#............................................\n.........................#...........#..........#............#...............................#...#...#..................#.........\n....#......................#......#.......#....................#..........................#...............................#.......\n.........................#...............#.........................#.........#..................................#.................\n...............................#......................................................#...........................................\n..................................................#.........................#...................#......#..........................\n...................#.##..............................#................#........#..............................#...................\n.#.................#..............................#................#............................#............#................#...\n............#..............#....................................#.....#.....#..........#................#.........................\n...................#.............................#...........##...........................................#.......................\n.#.............##...........#............##...#.........................................................................#.......#.\n........#................#....................#..........#....#.......#.#..............#..............#.................#.........\n............................#..#...#..........................................................#......#............................\n.........#.................#......#.............................................#...##.....#.................................##...\n............#..........................................................................#..........#...................#...........\n....................................#.............#............#..................#....#.#.......................#...#............\n......#...................................................##....................................................................#.\n...............................#.............#.#...............#.......................................#.#.......................#\n..........#............................#....#.#.#.#..............................................................#................\n....#...#............#.#.................................................#.....................................#.#................\n...........#...............................##.........#............#.....................#........................................\n...................#.............................#.........#..............................................#.....#.................\n.........#................#.........#.............#.............#...#...........................................................#.\n.....#...........................#............##............#................#...............................#.............#..#...\n................#.#.......#.................#...................................................#.........#..........##.#.........\n.........................#.................#...............#...........................#............#.............#..............#\n...................#......#...........................#.....#.....................................................#...............\n......#...........##......#..................#......#............##................................#..............................\n....................#.........#...........................................................................................#....#..\n................................................#....#.....#..#........................#....................##....................\n........#...........#....#.......#..........##............................................#.......#.........#...#...............#.\n#.#.....#.#..............................................#...#...............#..........#................##.........#..........#.#\n#........................#...#.........#........#..............................................................#..................\n..................................................................................................................................\n...........................................#..#..........................................#...................#....................\n...................#.............#.....#..................................................#...................................#...\n................#...........................................................................#.#...#...............................\n........#.......#......#...........................................#....................................#......#............#.....\n...............#.......#....................#.....................................................................#...............\n..............##....#.............................#......................#.....#......#........................................#..\n............................#.........#.....................#.....................................................................\n#....................#...................##........#...#........#......#....#..........................................#.#.......#\n..#............#...#...............................#.#....................#....................................#..............#...\n..................#..#.......#......#.....#.......#.................#.....#...................................#.............#.....\n.......................#..............#.........#............#.......#.................................................#.....#....\n................#.....................................................#.#.............................#.........#...........#.....\n......................#.................................##..................................#.................................#...\n.......................................#........................................................................#.................\n.........#...........#..............#......................#................................#..#.......................#..........\n...................#..................#...#....#......................................................#...........................\n..............................#.........#................................#............................#...........................\n........#....#...................................................................##........#......................................\n..................................#...................#...................#.#.......#.............#..............................#\n.....................................#...##...............................................................................#.......\n......................#.......#.............#.......................#..#.....#......................#.................#...........\n.....##...........#.......#................#.................................#...##......#......#...............#.......#.#.......\n.....#...#...............#......................#........#..........#..##...#...#........#..........#.............................\n#...........#.............#...............................#..............................#...#.#........#.........................";

const pt1DistinctVisitedPositions:HTMLTableCellElement = <HTMLTableCellElement>document.getElementById('pt1DistinctVisitedPositions');

enum SpaceChars {
  VALID_SPACE = '.',
  INVALID_SPACE = '#',
  VISITED_SPACE = 'X'
}
enum Direction {
  Up = 1,
  Down,
  Left,
  Right
}
interface DirectionCharsInterface {
  [index:number]:string;
}
const DirectionChars: DirectionCharsInterface = {
  1: '^',
  2: 'v',
  3: '<',
  4: '>'
}
class Player {
  private currRow: number;
  private currCol: number;
  private currDir: Direction;

  constructor(row:number = 0,col:number = 0,dir:Direction = Direction.Right) {
    this.currRow = row;
    this.currCol = col;
    this.currDir = dir;
  }
  move() {
    let dir:Direction = this.currDir;

    switch(dir) {
      case Direction.Up:
        this.currRow -= 1;
      break;
      case Direction.Down:
        this.currRow += 1;
      break;
      case Direction.Left:
        this.currCol -= 1;
      break;
      case Direction.Right:
        this.currCol += 1;
      break;
    }
  }
  rotate() {
    let dir:Direction = this.currDir;

    switch(dir) {
      case Direction.Up:
        this.currDir = Direction.Right;
      break;
      case Direction.Down:
        this.currDir = Direction.Left;
      break;
      case Direction.Left:
        this.currDir = Direction.Up;
      break;
      case Direction.Right:
        this.currDir = Direction.Down;
      break;
    }
  }

  set direction(dir:Direction) {
    this.currDir = dir;
  }
  get direction():Direction {
    return this.currDir;
  }
  set row(rowNum:number) {
    this.currRow = rowNum;
  }
  get row():number {
    return this.currRow
  }
  set col(colNum:number) {
    this.currCol = colNum;
  }
  get col():number {
    return this.currCol;
  }
}
class Board {
  private rows:string[];

  constructor(gameBoard:string) {
    this.rows = gameBoard.split('\n');
  }
  getSpace(rowNum:number,colNum:number):string {
    return this.rows[rowNum][colNum];
  }
  setSpace(rowNum:number,colNum:number,character:string) {
    let row:string = this.rows[rowNum];
    let chars:string[] = row.split('');
    chars.splice(colNum,1,character);
    this.rows[rowNum] = chars.join('');
  }
  canMove(player:Player):boolean {
    let canMove:boolean = false;
    // Check direction
    let dir:Direction = player.direction;
    // Check if there is an obstacle
    switch ( dir ) {
      case Direction.Up:
        canMove = (this.getSpace(player.row - 1, player.col) === SpaceChars.VALID_SPACE) || (this.getSpace(player.row - 1, player.col) === SpaceChars.VISITED_SPACE);
      break;
      case Direction.Down:
        canMove = (this.getSpace(player.row + 1, player.col) === SpaceChars.VALID_SPACE) || (this.getSpace(player.row + 1, player.col) === SpaceChars.VISITED_SPACE);
      break;
      case Direction.Left:
        canMove = (this.getSpace(player.row, player.col - 1) === SpaceChars.VALID_SPACE) || (this.getSpace(player.row, player.col - 1) === SpaceChars.VISITED_SPACE);
      break;
      case Direction.Right:
        canMove = (this.getSpace(player.row, player.col + 1) === SpaceChars.VALID_SPACE) || (this.getSpace(player.row, player.col + 1) === SpaceChars.VISITED_SPACE);
      break;
    }

    return canMove;
  }
  willLeaveBoard(player:Player) {
    let isDone:boolean = false;
    let dir:Direction = player.direction;

    switch ( dir ) {
      case Direction.Up:
        isDone = player.row === 0;
      break;
      case Direction.Down:
        isDone = player.row === this.rows.length - 1;
       break;
      case Direction.Left:
        isDone = player.col === 0;
      break;
      case Direction.Right:
        isDone = player.col === this.rows[0].length - 1;
      break;
    }

    return isDone;
  }
  move(player:Player) {
    // Set the old space of the player to a visited space
    this.setSpace(player.row,player.col,SpaceChars.VISITED_SPACE);
    // Move the player
    player.move();
    this.setSpace(player.row,player.col,DirectionChars[player.direction]);
  }
  rotate(player:Player) {
    player.rotate();
    this.setSpace(player.row,player.col,DirectionChars[player.direction]);
  }
  getTraveledPositions():number {
    let traveledPositions:number = this.rows.reduce((acc:number,row:string) => {
      let regExp:RegExp = new RegExp(SpaceChars.VISITED_SPACE,'g')
      let match:RegExpMatchArray | null = row.match(regExp);

      match && (acc += match.length);

      return acc;
    },0);
    // + 1 accounts for the last position the piece lands on before "leaving" the board
    return traveledPositions + 1;
  }
}
class Game {
  private board:Board;
  private player:Player;

  constructor(gameBoard:string) {
    const rows:string[] = gameBoard.split('\n');
    this.player = new Player();
    this.board = new Board(gameBoard);

    if ( gameBoard.includes(DirectionChars[Direction.Up]) )
      this.player.direction = Direction.Up;
    else if ( gameBoard.includes(DirectionChars[Direction.Down]) )
      this.player.direction = Direction.Down;
    else if ( gameBoard.includes(DirectionChars[Direction.Right]) )
      this.player.direction = Direction.Right;
    else if ( gameBoard.includes(DirectionChars[Direction.Left]) )
      this.player.direction = Direction.Left;


    for ( let i = 0; i < rows.length; i++ ) {
      if ( rows[i].includes(DirectionChars[this.player.direction]) ) {
        this.player.row = i;
        this.player.col = rows[i].indexOf(DirectionChars[this.player.direction]);
      }
    }
  }
  start() {
    while ( !this.board.willLeaveBoard(this.player) ) {
      if ( this.board.canMove(this.player) ) {
        this.board.move(this.player);
      }
      else {
        this.player.rotate();
      }
    }
  }
  getTraveledPositions():number {
    return this.board.getTraveledPositions();
  }
}

const game:Game = new Game(input);
game.start();

pt1DistinctVisitedPositions.textContent = game.getTraveledPositions().toString();